<link rel="import" href="../polymer/polymer.html" />  
<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html" />
<link rel="import" href="../iron-icons/iron-icons.html" />
<link rel="import" href="../t-shared-lib/t-fare-behavior.html">
<link rel="import" href="../t-text-container/t-text-container.html">

<dom-module id="t-hotel-itinerary-item">
    <style>           
    </style>
    <template>        
        <div>
            <template is="dom-if" if="{{itinerary.deal}}">                
               <span style="color:red"> {{itinerary.deal.description}}</span>
               <br/>
            </template>
            <img src="{{itinerary.heroImageUrl}}" style="height:75px;width:75px">
            <span>{{itinerary.name}}</span><br/>
            <span>{{itinerary.address}}</span>
            <template is="dom-repeat" items="{{_numberToArray(itinerary.rating)}}">
                <iron-icon icon="star"></iron-icon>
            </template>
            <template is="dom-if" if="{{_discount.money.amount}}">                
                With out discount {{_getDisplayFare(_totalFareWithOutDiscount.money.amount, itinerary.stayDuration.start.date, itinerary.stayDuration.end.date)}} <br/>
            </template>
            With discount {{_getDisplayFare(_totalFare.money.amount, itinerary.stayDuration.start.date, itinerary.stayDuration.end.date)}} avg/night <br/>

            <template is="dom-if" if="{{showDebugInfo}}">
                <div>
                    isPostPaid - {{itinerary.isPostPaid}} <br/>
                    supplier source - {{itinerary.source.name}}
                </div>
            </template>
        </div>
    </template>
</dom-module>
<script>
    Polymer({

        is: 't-hotel-itinerary-item',

        properties: {

            itinerary: {
                type: Object,
                value: function(){
                    return {};
                }
            },
            showDebugInfo: {
                type: Boolean,
                value: true
            }

        },

        observers: [ '_fareComponentsChanged(itinerary.fare.components)' ],

        behaviors: [TravelNxt.Behaviors.FareBehavior],

        _fareComponentsChanged: function(components){        
            this._components = components;
            //this.notifyPath('_components', components);
        },

        _numberToArray: function(number){
            var arr =[];
            for (var i = 0; i < number; i++) {
                arr.push(i);
            };
            return arr;
        },

        _getDisplayFare: function(amount, checkIn, checkOut){
            if(amount){
                return parseInt(amount / this._dateDiff(checkIn, checkOut));
            }
            return null;
        },

        _dateDiff: function(fromDate, toDate) { 
            if(!fromDate || !toDate)       
                return 0;
            if(typeof fromDate == 'string'){
                fromDate = new Date(fromDate);
            }
            if(typeof toDate == 'string'){
                toDate = new Date(toDate);
            }
            var diff = toDate - fromDate; 
            var divideBy = (24 * 60 * 60 * 1000) ; 
              
            return Math.floor( diff/divideBy);
        }
    })
</script>
