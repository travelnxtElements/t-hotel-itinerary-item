<link rel="import" href="../polymer/polymer.html" />  
<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html" />
<link rel="import" href="../iron-icons/iron-icons.html" />
<link rel="import" href="../t-shared-lib/t-fare-behavior.html">

<dom-module id="t-hotel-itinerary-item">
    <style>           
    </style>
    <template>        
        <img src="{{itinerary.heroImageUrl}}">
        <span>{{itinerary.name}}</span><br/>
        <span>{{itinerary.address}}</span>
        <template is="dom-repeat" items="{{_numberToArray(itinerary.rating)}}">
            <iron-icon icon="star"></iron-icon>
        </template>
        <template is="dom-if" if="_totalFareWithOutDiscount">
            With out discount {{_getDisplayFare(_totalFareWithOutDiscount, checkIn, checkOut)}} <br/>
        </template>
        With discount {{_getDisplayFare(_totalFare, checkIn, checkOut)}} avg/night <br/>

    </template>
</dom-module>
<script>
    Polymer({

        is: 't-hotel-itinerary-item',

        properties: {

            itinerary: {
                type: Object,
                value: function(){
                    return {};
                }
            },

            checkIn: String,

            checkOut: String


        },

        observers: [ '_fareComponentsChanged(itinerary.fare.components)' ],

        behaviors: [TravelNxt.Behaviors.ProviderBehavior],

        _fareComponentsChanged: function(components){        
            this._components = components;
        },

        _numberToArray: function(number){
            var arr =[];
            for (var i = 0; i < number; i++) {
                arr.push(i);
            };
            return arr;
        },

        _getDisplayFare: function(fare, checkIn, checkOut){
            if(fare && fare.money){
                return parseInt(fare.money.amount / this._dateDiff(checkIn, checkOut));
            }
            return null;
        },

        _dateDiff: function(fromDate, toDate) { 
            if(!fromDate || !toDate)       
                return 0;
            if(typeof fromDate == 'string'){
                fromDate = new Date(fromDate);
            }
            if(typeof toDate == 'string'){
                toDate = new Date(toDate);
            }
            var diff = toDate - fromDate; 
            var divideBy = (24 * 60 * 60 * 1000) ; 
              
            return Math.floor( diff/divideBy);
        },

    })
</script>
